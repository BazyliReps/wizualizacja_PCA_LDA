---
title: "Zastosowanie SOM dla danych giełdowych"
author: "Łukasz Knigawka, Bazyli Reps"
output: pdf_document
---

Dokument przedstawia zastosowanie map samoorganizujących na danych giełdowych. Wykorzystano dane giełdowe z początku maja 2020, czyli obserwacje z czasów pandemii koronawirusa. Do pobrania danych wykorzystano bibliotekę quantmod. Analizie poddano dane spółek Amazon (AMZN), Apple (AAPL), Uber (UBER), Netflix (NFLX), Spotify (SPOT).

Mapy samoorganizujące to sieci neuronów, z którymi są stowarzyszone współrzędne na prostej, płaszczyźnie lub w dowolnej n-wymiarowej przestrzeni. Uczenietego tego rodzaju sieci polega na zmianach współrzędnych neuronów, tak, by dążyły one do wzorca zgodnego ze strukturą analizowanych danych. Sieci zatem „rozpinają się” wokół zbiorów danych, dopasowując do nich swoją strukturę. Sieci te klasyfikują wielowymiarowe dane wejściowe w taki sposób, by możliwa była ich reprezentacji w mniejszej ilości wymiarów - przeważnie dwóch - przy jednoczesnym jak najwierniejszym odwzorowaniu struktury wewnętrznej wektora wejściowego.


```{r}
if (!require("quantmod")) {
    install.packages("quantmod")
    library(quantmod)
}
if (!require("kohonen")) {
    install.packages("kohonen")
    library(kohonen)
}
```

Sprawdźmy, jak prezentowały się przez wybrane 4 miesiące kursy wybranych spółek.

```{r}
start <- as.Date("2020-01-01")
end <- as.Date("2020-05-01")

getSymbols("AMZN", src = "yahoo", from = start, to = end)
getSymbols("AAPL", src = "yahoo", from = start, to = end)
getSymbols("UBER", src = "yahoo", from = start, to = end)
getSymbols("NFLX", src = "yahoo", from = start, to = end)
getSymbols("SPOT", src = "yahoo", from = start, to = end)
head(SPOT)
```
```{r}
plot(AMZN[, "AMZN.Close"], main = "AMZN")
plot(AAPL[, "AAPL.Close"], main = "AAPL")
plot(UBER[, "UBER.Close"], main = "UBER")
plot(NFLX[, "NFLX.Close"], main = "NFLX")
plot(SPOT[, "SPOT.Close"], main = "SPOT")
```

Możemy zaobserwować, że wszystkie wybrane spółki znacznie odczuły marcowe załamanie giełdowe. Niektóre z nich (Netflix, Amazon) zanotowały wkrótce wzrost wartości do poziomu wyższego niż przed załamaniem, podczas gdy inne nie wróciły na dawny poziom.

Sprawdźmy jeszcze na wspólnym wykresie jak prezentowały się ceny akcji wybranych spółek. 

```{r}
stocks <- as.xts(data.frame(AMZN = AMZN[, "AMZN.Close"], AAPL = AAPL[, "AAPL.Close"], UBER = UBER[, "UBER.Close"], NFLX = NFLX[, "NFLX.Close"], SPOT = SPOT[, "SPOT.Close"]))
head(stocks)
```
```{r}
plot(as.zoo(stocks), screens = 1, lty = 1:5, xlab = "Date", ylab = "Price", col = topo.colors(10))
legend("right", c("AMZN", "AAPL", "UBER", "NFLX", "SPOT"), lty = 1:3, cex = 0.5, col = topo.colors(10))
```
```{r}
head(AMZN, 10)
```

Przeskalowano dane przed wykorzystaniem ich do analizy map samoorganizujących. Do wykonania analizy wykorzystano bibliotekę kohonen.

```{r}
AMZN.measures <- c("Open, High, Low, Close, Volume, Adjusted")
AMZN.sc = scale(AMZN[, 1:6])
head(AMZN.sc)
```
```{r}
AMZN.grid = somgrid(xdim = 7, ydim=7, topo="hexagonal")
AMZN.som = som(AMZN.sc, grid=AMZN.grid, rlen=100, alpha=c(0.05,0.01))
```
Sprawdżmy jak przebiegał proces treningowy. Wraz z następowaniem kolejnych iteracji procesu uczenia, dystans między neuronami zmniejszał się. Możliwe że model jest nieco niedotrenowany, gdyż widzimy, że odległość maleje wciąż przy setnej oteracji.
```{r}
plot(AMZN.som, type="changes")
```

Pakiet kohonen umożliwia przedstawienie wykresu na którym widać, ile obserwacji trafiło do której komórki.

```{r}
plot(AMZN.som, type="count")
```

Poniższy wykres przedstawia odległości komórek od najbliższych sąsiadów. Taka wizualizaca nosi także nazwę U-macierzy.

```{r}
plot(AMZN.som, type="dist.neighbours")
```

Poniższy wykres przedstawia charakterystykę obserwacji znajdujących się w danych komórkach.

```{r}
plot(AMZN.som, type="codes")
```



